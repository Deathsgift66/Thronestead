<!--
Project Name: Thronestead©
File Name: seasonal-effects.html
Version:  7/1/2025 10:38
Developer: Deathsgift66
-->

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; frame-ancestors 'none';" />
  
  <title>Seasonal Effects | Thronestead</title>
  <meta name="description" content="View and manage seasonal effects impacting your kingdom — adapt strategy and leverage advantages." />
  <meta property="og:title" content="Seasonal Effects | Thronestead" />
  <meta property="og:description" content="View and manage seasonal effects impacting your kingdom — adapt strategy and leverage advantages." />
  <meta property="og:image" content="Assets/banner_main.png" />
  <meta property="og:url" content="seasonal-effects.html" />
  <meta property="og:type" content="website" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Seasonal Effects | Thronestead" />
  <meta name="twitter:description" content="View and manage seasonal effects impacting your kingdom — adapt strategy and leverage advantages." />
  <meta name="twitter:image" content="Assets/banner_main.png" />
  <meta name="keywords" content="Thronestead, seasonal effects, world events, strategy, kingdom impact" />
  <meta name="robots" content="index, follow" />
  <link rel="canonical" href="https://www.thronestead.com/seasonal-effects.html" />
  <meta name="theme-color" content="#2e2b27" />

  <!-- Page-Specific Assets -->
  <link href="/CSS/seasonal_effects.css" rel="stylesheet" />
  <script src="/Javascript/seasonal-effects.js" type="module"></script>

  <!-- Global Assets -->
  <link rel="icon" href="/Assets/favicon.ico" type="image/x-icon" />
  <link href="/CSS/root_theme.css" rel="stylesheet" />
  <link href="/CSS/kr_navbar.css" rel="stylesheet" />
  <link href="/CSS/resource_bar.css" rel="stylesheet" />

<!-- ✅ Injected standard Thronestead modules -->
  <script src="/Javascript/components/auth-guard.js" type="module"></script>
  <script src="/Javascript/api-helper.js" type="module"></script>
  <script src="/Javascript/nav-loader.js" type="module"></script>
  <script src="/Javascript/modal-fallback.js" type="module"></script>
  <script src="/Javascript/resource-bar.js" type="module"></script>
</head>

<body class="medieval-page">
  <noscript>
    <div class="noscript-warning">
      JavaScript is disabled in your browser. Some features of Thronestead may not function correctly.
    </div>
  </noscript>

<div id="navbar-container"></div>
<div id="resource-bar-container"></div>

<!-- Navbar -->

<!-- Page Banner -->
<header class="kr-top-banner" aria-label="Seasonal Effects Banner">
  Thronestead — Seasonal Effects
</header>

<!-- Main Layout -->
<main role="main" id="main-content" class="main-centered-container" aria-label="Seasonal Effects Dashboard">

  <section class="alliance-members-container">

    <div class="seasonal-banner" role="region" aria-labelledby="seasonal-intro-title">
      <h2 id="seasonal-intro-title">Current Seasonal Effects</h2>
      <p>Adapt your strategy based on dynamic seasonal changes in the world of Thronestead.</p>
    </div>

    <!-- Each seasonal card represents a data section and is dynamically updated -->
    <div class="card" role="region" aria-labelledby="modifiers-title">
      <h3 id="modifiers-title">Active Modifiers</h3>
      <div id="active-modifiers" class="custom-scrollbar"></div>
    </div>

    <div class="card" role="region" aria-labelledby="season-timer-title">
      <h3 id="season-timer-title">Season Timer</h3>
      <div id="season-timer" class="custom-scrollbar"></div>
    </div>

    <div class="card" role="region" aria-labelledby="forecast-wheel-title">
      <h3 id="forecast-wheel-title">Forecast Wheel</h3>
      <div id="forecast-wheel" class="custom-scrollbar"></div>
    </div>

    <div class="card" role="region" aria-labelledby="lore-scroll-title">
      <h3 id="lore-scroll-title">Lore Scroll</h3>
      <div id="lore-scroll" class="custom-scrollbar"></div>
    </div>

    <div class="card" role="region" aria-labelledby="kingdom-impact-title">
      <h3 id="kingdom-impact-title">Kingdom Impact</h3>
      <div id="kingdom-impact" class="custom-scrollbar"></div>
    </div>

    <div class="card" role="region" aria-labelledby="market-projections-title">
      <h3 id="market-projections-title">Market Projections</h3>
      <div id="market-projections" class="custom-scrollbar"></div>
    </div>

  </section>
</main>

  <div id="loading-overlay" aria-hidden="true">
    <div class="spinner"></div>
  </div>

<!-- Toast for real-time updates -->
<div id="toast" class="toast-notification" role="status" aria-live="polite"></div>

<!-- Forecast Modal -->
<div id="forecast-modal" class="modal-overlay hidden" role="dialog" aria-modal="true" aria-labelledby="forecast-modal-label" inert>
  <div class="modal-content">
    <h4 id="forecast-modal-label">Forecast Details</h4>
    <div id="forecast-modal-body"></div>
    <button class="btn-fantasy" id="close-forecast-modal">Close</button>
  </div>
</div>

<!-- Footer -->
<footer class="site-footer" role="contentinfo">
  <div>© 2025 Thronestead</div>
  <div><a href="legal.html" target="_blank">View Legal Documents</a> <a href="sitemap.xml" target="_blank">Site Map</a></div>
</footer>

<!-- Backend route definition for reference -->
<script type="text/python">
from fastapi import APIRouter, Depends, HTTPException

from ..security import verify_jwt_token
from ..supabase_client import get_supabase_client

router = APIRouter(prefix="/api/seasonal-effects", tags=["seasonal_effects"])


@router.get("/")
def seasonal_data(user_id: str = Depends(verify_jwt_token)):
    """
    Return the current seasonal effect and a short forecast list.

    This endpoint is intended to support real-time gameplay changes and planning.
    """

    supabase = get_supabase_client()

    try:
        current_res = (
            supabase.table("seasonal_effects")
            .select("*")
            .eq("active", True)
            .single()
            .execute()
        )
        current = (
            current_res.get("data")
            if isinstance(current_res, dict)
            else getattr(current_res, "data", None)
        )
        if not current:
            raise HTTPException(status_code=404, detail="Current season not found")
    except Exception as e:
        raise HTTPException(
            status_code=500, detail="Failed to fetch current season"
        ) from e

    try:
        forecast_res = (
            supabase.table("seasonal_effects")
            .select("*")
            .order("start_date", ascending=True)
            .limit(4)
            .execute()
        )
        forecast = (
            forecast_res.get("data")
            if isinstance(forecast_res, dict)
            else getattr(forecast_res, "data", [])
        ) or []
    except Exception as e:
        raise HTTPException(
            status_code=500, detail="Failed to fetch seasonal forecast"
        ) from e

    return {"current": current, "forecast": forecast}
</script>

</body>
</html>
